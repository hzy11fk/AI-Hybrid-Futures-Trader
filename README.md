AI糊的币安合约量化工具，可自选币对进行合约交易。
# 高级动态趋势追踪合约交易机器人 (Advanced Dynamic Trend-Following Futures Bot)

这是一款专为币安(Binance)U本位合约设计的全自动量化交易机器人，旨在识别并捕捉市场趋势。它集成了一套复杂的多层风险管理系统、基于历史表现的动态参数自适应调整机制，并配备了一个用于全面监控的实时Web界面。
其核心策略基于双时间周期共振原理，通过较长周期（如15分钟）确认宏观趋势，在较短周期（如5分钟）寻找回调机会入场。开仓后，策略通过一个智能的两阶段追踪止损系统和金字塔式浮盈加仓策略来精细化地管理头寸，力求在控制风险的同时最大化趋势行情带来的利润。

## 核心功能亮点

-   **双周期共振趋势判断**: 结合快周期（5m）的交易信号与慢周期（15m）的趋势过滤，确保交易方向与市场主旋律一致，提高胜率。
-   **多维度信号确认机制**: 运用成交量(Volume)、相对强弱指数(RSI)和平均动向指数(ADX)对趋势信号进行严格验证，有效过滤掉虚假信号和弱势趋势。
-   **智能两阶段动态止损系统**:
    * **第一阶段 (风险规避)**: 开仓初期，采用基于当前价格的紧密ATR追踪止损，目标是快速将止损位推过成本价，实现头寸的“零风险”保护。
    * **第二阶段 (利润最大化)**: 当浮动盈利达到预设阈值（如2R）后，止损模式自动**升级**为更宽松的**吊灯止损 (Chandelier Exit)**。这种模式能容忍趋势中的正常回调，避免被市场噪音“洗出局”，从而有更大机会捕捉完整的主升浪或主跌浪。
-   **利润驱动的金字塔加仓**: 当持仓盈利达到初始风险（1R）的整数倍时，策略会自动加仓，以“倒金字塔”模式（每次加仓量递减）在正确的方向上增加头寸，实现利润的指数级增长。
-   **多信号激进模式**:
    * **突破侦测**: 通过布林带（Bollinger Bands）实时监控价格，一旦发生突破，策略将临时进入“激进模式”，放宽入场审查标准以抓住爆发性行情。
    * **激增侦测**: 监控K线实体和成交量的突然放大，一旦侦测到“激增”信号，将激活“超级激进模式”，以最快的速度寻找回调入场机会。
-   **基于表现的自我进化**: 策略会周期性地评估自身的交易表现（胜率、盈亏比、最大回撤），并根据得分动态调整核心参数（如回调区宽度、ATR乘数等），在“激进型”和“防御型”两种风格之间自适应切换。
-   **强大的实时Web监控仪表盘**: 内置一个基于`aiohttp`的异步Web服务器，提供：
    * 带有持仓线、止损线和信号指标的实时K线图表。
    * 每个交易对的详细状态面板，包括趋势分析、信号数据和业绩指标。
    * 全局账户权益、已实现盈亏的实时追踪。
    * 系统运行日志的实时滚动输出。
-   **稳健的状态与利润追踪**: 所有的持仓状态和交易利润都以`.json`格式持久化存储在硬盘上，即使程序重启也能恢复之前的状态，确保数据不丢失。
-   **实时交易通知**: 通过Bark应用，将所有关键交易事件（开仓、平仓、加仓、止损更新等）实时推送到您的移动设备。

## 文件结构与作用

项目采用模块化设计，每个文件各司其职，结构清晰。

| 文件                  | 作用                                                                                                                        |
| --------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| `main.py`             | **程序启动入口 (The Ignition Key)**: 整个机器人的总启动脚本，负责初始化所有模块并启动主事件循环。                                 |
| `futures_trader.py`   | **策略大脑 (The Strategy Brain)**: 包含交易策略的核心逻辑，负责决策、执行和管理所有交易行为。                                   |
| `exchange_client.py`  | **交易所通信官 (The Exchange Communicator)**: 封装了所有与币安交易所的API交互（获取数据、下单等），为策略提供统一接口。           |
| `position_tracker.py` | **仓位记账员 (The Position Accountant)**: 实时跟踪和管理每个交易对的持仓状态，包括成本、数量、止损阶段等。                      |
| `profit_tracker.py`   | **业绩分析师 (The Performance Analyst)**: 记录每一笔已平仓交易的盈亏，并计算胜率、盈亏比、最大回撤等关键性能指标（KPIs）。      |
| `web_server.py`       | **监控仪表盘 (The Monitoring UI)**: 运行一个`aiohttp` Web服务器，提供实时监控前端页面。                                         |
| `config.py`           | **中央控制面板 (The Control Panel)**: 集中管理所有策略参数、API密钥加载逻辑和功能开关。                                         |
| `helpers.py`          | **辅助工具箱 (The Utility Toolkit)**: 包含辅助函数，主要用于设置日志系统和发送Bark通知。                                        |
| `.env`                | **密码保险箱 (The Vault)**: 用于存放敏感信息，如API密钥和Bark URL，此文件不应上传到代码仓库。                                      |

## 快速上手指南

请遵循以下步骤来配置和运行您的交易机器人。

### 1. 环境准备

-   Python 3.10 或更高版本
-   一个币安账户（建议先在测试网注册）并创建API密钥
-   (可选) 在您的iOS设备上安装Bark应用以接收通知

### 2. 安装

1.  **克隆代码仓库:**

    git clone https://your-repo-url/here.git
    cd your-repo-folder

2.  **安装所需的Python库:**

    pip install -r requirements.txt

### 3. 配置

1.  **创建 `.env` 文件:**
    在项目的根目录下，创建一个名为 `.env` 的文件。

2.  **编辑 `.env` 文件:**
    将以下内容复制到 `.env` 文件中，并填入您自己的密钥信息。

    ```env
    # --- 币安实盘账户 API 密钥 ---
    BINANCE_API_KEY="你的实盘API_KEY"
    BINANCE_SECRET_KEY="你的实盘SECRET_KEY"

    # --- 币安测试网账户 API 密钥 (在 [https://testnet.binancefuture.com/](https://testnet.binancefuture.com/) 申请) ---
    BINANCE_TESTNET_API_KEY="你的测试网API_KEY"
    BINANCE_TESTNET_SECRET_KEY="你的测试网SECRET_KEY"

    # --- Bark 推送服务的 URL Key (可选) ---
    # 示例: "[https://api.day.app/你的BARK设备KEY/](https://api.day.app/你的BARK设备KEY/)"
    BARK_URL_KEY="你的BARK_URL_WITH_KEY"
    ```

3.  **调整 `config.py` 中的策略参数:**
    打开 `config.py` 文件，您可以精细地调整策略的每一个细节。关键配置项包括：
    -   `USE_TESTNET`: 设置为 `True` 使用测试网，`False` 则使用实盘（**请务必先在测试网充分测试！**）。
    -   `FUTURES_SYMBOLS_LIST`: 您希望机器人交易的币对列表，例如 `["BTC/USDT:USDT", "ETH/USDT:USDT"]`。
    -   `FUTURES_INITIAL_PRINCIPAL`: 您的初始本金，用于精确计算盈亏率。
    -   `FUTURES_LEVERAGE` 和 `FUTURES_RISK_PER_TRADE_PERCENT`: 核心的风险管理参数。
    -   所有其他参数在文件中都有详细的中文注释。

## 如何运行


2.  **启动机器人:**
    在您的终端中运行 `main.py` 脚本：
    
    python main.py

4.  **通过Web UI监控:**
    机器人启动后，打开您的浏览器，访问终端日志中显示的地址，通常是：
    **`http://0.0.0.0:58182`** 或 **`http://localhost:58182`**

现在，您的交易机器人已经正式上线。它将开始分析市场并根据设定的策略执行交易。所有操作都会被记录到控制台、`logs/`目录下的日志文件以及Web UI中。

## 免责声明

加密货币交易涉及巨大风险，可能不适合所有投资者。本软件的作者不对您可能遭受的任何财务损失负责。请自行承担使用此机器人的风险，并仅使用您能够承受损失的资金进行交易。强烈建议在投入真实资金之前，先在**币安测试网**上进行充分的测试和验证。

